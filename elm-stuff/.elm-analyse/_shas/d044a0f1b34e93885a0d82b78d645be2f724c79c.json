{"moduleDefinition":{"range":[1,1,1,51],"value":{"type":"normal","normal":{"moduleName":{"range":[1,8,1,32],"value":["Playground","Extra","Tilemap"]},"exposingList":{"range":[1,33,1,51],"value":{"type":"explicit","explicit":[{"range":[1,43,1,50],"value":{"type":"function","function":{"name":"tilemap"}}}]}}}}},"imports":[{"range":[3,1,3,42],"value":{"moduleName":{"range":[3,8,3,20],"value":["Math","Vector2"]},"moduleAlias":null,"exposingList":{"range":[3,21,3,42],"value":{"type":"explicit","explicit":[{"range":[3,31,3,35],"value":{"type":"typeOrAlias","typeOrAlias":{"name":"Vec2"}}},{"range":[3,37,3,41],"value":{"type":"function","function":{"name":"vec2"}}}]}}}},{"range":[4,1,4,36],"value":{"moduleName":{"range":[4,8,4,20],"value":["Math","Vector4"]},"moduleAlias":null,"exposingList":{"range":[4,21,4,36],"value":{"type":"explicit","explicit":[{"range":[4,31,4,35],"value":{"type":"typeOrAlias","typeOrAlias":{"name":"Vec4"}}}]}}}},{"range":[5,1,5,58],"value":{"moduleName":{"range":[5,8,5,25],"value":["Playground","Render"]},"moduleAlias":null,"exposingList":{"range":[5,26,5,58],"value":{"type":"explicit","explicit":[{"range":[5,36,5,57],"value":{"type":"function","function":{"name":"defaultEntitySettings"}}}]}}}},{"range":[6,1,6,35],"value":{"moduleName":{"range":[6,8,6,25],"value":["Playground","Shader"]},"moduleAlias":{"range":[6,29,6,35],"value":["Shader"]},"exposingList":null}},{"range":[7,1,7,31],"value":{"moduleName":{"range":[7,8,7,13],"value":["WebGL"]},"moduleAlias":null,"exposingList":{"range":[7,14,7,31],"value":{"type":"explicit","explicit":[{"range":[7,24,7,30],"value":{"type":"typeOrAlias","typeOrAlias":{"name":"Shader"}}}]}}}},{"range":[8,1,8,62],"value":{"moduleName":{"range":[8,8,8,21],"value":["WebGL","Shape2d"]},"moduleAlias":null,"exposingList":{"range":[8,22,8,62],"value":{"type":"explicit","explicit":[{"range":[8,32,8,40],"value":{"type":"typeexpose","typeexpose":{"name":"Form","open":[8,36,8,40]}}},{"range":[8,42,8,48],"value":{"type":"typeOrAlias","typeOrAlias":{"name":"Render"}}},{"range":[8,50,8,61],"value":{"type":"typeexpose","typeexpose":{"name":"Shape2d","open":[8,57,8,61]}}}]}}}},{"range":[9,1,9,40],"value":{"moduleName":{"range":[9,8,9,21],"value":["WebGL","Texture"]},"moduleAlias":null,"exposingList":{"range":[9,22,9,40],"value":{"type":"explicit","explicit":[{"range":[9,32,9,39],"value":{"type":"typeOrAlias","typeOrAlias":{"name":"Texture"}}}]}}}}],"declarations":[{"range":[12,1,74,10],"value":{"type":"function","function":{"documentation":null,"signature":{"range":[12,1,12,56],"value":{"name":{"range":[12,1,12,8],"value":"tilemap"},"typeAnnotation":{"range":[12,11,12,56],"value":{"type":"function","function":{"left":{"range":[12,11,12,16],"value":{"type":"typed","typed":{"moduleNameAndName":{"range":[12,11,12,16],"value":{"moduleName":[],"name":"Float"}},"args":[]}}},"right":{"range":[12,20,12,56],"value":{"type":"function","function":{"left":{"range":[12,20,12,25],"value":{"type":"typed","typed":{"moduleNameAndName":{"range":[12,20,12,25],"value":{"moduleName":[],"name":"Float"}},"args":[]}}},"right":{"range":[12,29,12,56],"value":{"type":"function","function":{"left":{"range":[12,29,12,35],"value":{"type":"typed","typed":{"moduleNameAndName":{"range":[12,29,12,35],"value":{"moduleName":[],"name":"String"}},"args":[]}}},"right":{"range":[12,39,12,56],"value":{"type":"function","function":{"left":{"range":[12,39,12,45],"value":{"type":"typed","typed":{"moduleNameAndName":{"range":[12,39,12,45],"value":{"moduleName":[],"name":"String"}},"args":[]}}},"right":{"range":[12,49,12,56],"value":{"type":"typed","typed":{"moduleNameAndName":{"range":[12,49,12,56],"value":{"moduleName":[],"name":"Shape2d"}},"args":[]}}}}}}}}}}}}}}}}},"declaration":{"range":[13,1,74,10],"value":{"name":{"range":[13,1,13,8],"value":"tilemap"},"arguments":[{"range":[13,9,13,14],"value":{"type":"var","var":{"value":"tileW"}}},{"range":[13,15,13,20],"value":{"type":"var","var":{"value":"tileH"}}},{"range":[13,21,13,28],"value":{"type":"var","var":{"value":"tileset"}}},{"range":[13,29,13,32],"value":{"type":"var","var":{"value":"lut"}}}],"expression":{"range":[14,5,74,10],"value":{"type":"application","application":[{"range":[14,5,14,12],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"Shape2d"}}},{"range":[15,9,74,10],"value":{"type":"record","record":[{"range":[15,11,15,16],"value":{"field":{"range":[15,11,15,12],"value":"x"},"expression":{"range":[15,15,15,16],"value":{"type":"integer","integer":0}}}},{"range":[16,11,17,9],"value":{"field":{"range":[16,11,16,12],"value":"y"},"expression":{"range":[16,15,16,16],"value":{"type":"integer","integer":0}}}},{"range":[17,11,18,9],"value":{"field":{"range":[17,11,17,12],"value":"a"},"expression":{"range":[17,15,17,16],"value":{"type":"integer","integer":0}}}},{"range":[18,11,19,9],"value":{"field":{"range":[18,11,18,13],"value":"sx"},"expression":{"range":[18,16,18,17],"value":{"type":"integer","integer":1}}}},{"range":[19,11,20,9],"value":{"field":{"range":[19,11,19,13],"value":"sy"},"expression":{"range":[19,16,19,17],"value":{"type":"integer","integer":1}}}},{"range":[20,11,21,9],"value":{"field":{"range":[20,11,20,12],"value":"o"},"expression":{"range":[20,15,20,16],"value":{"type":"integer","integer":1}}}},{"range":[21,11,74,9],"value":{"field":{"range":[21,11,21,15],"value":"form"},"expression":{"range":[22,13,73,18],"value":{"type":"application","application":[{"range":[22,13,22,21],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"Textured"}}},{"range":[22,22,22,29],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileset"}}},{"range":[23,17,73,18],"value":{"type":"parenthesized","parenthesized":{"range":[23,18,73,17],"value":{"type":"lambda","lambda":{"patterns":[{"range":[23,19,23,27],"value":{"type":"var","var":{"value":"tileset_"}}}],"expression":{"range":[24,21,72,26],"value":{"type":"application","application":[{"range":[24,21,24,28],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"Shape2d"}}},{"range":[25,25,72,26],"value":{"type":"record","record":[{"range":[25,27,25,32],"value":{"field":{"range":[25,27,25,28],"value":"x"},"expression":{"range":[25,31,25,32],"value":{"type":"integer","integer":0}}}},{"range":[26,27,27,25],"value":{"field":{"range":[26,27,26,28],"value":"y"},"expression":{"range":[26,31,26,32],"value":{"type":"integer","integer":0}}}},{"range":[27,27,28,25],"value":{"field":{"range":[27,27,27,28],"value":"a"},"expression":{"range":[27,31,27,32],"value":{"type":"integer","integer":0}}}},{"range":[28,27,29,25],"value":{"field":{"range":[28,27,28,29],"value":"sx"},"expression":{"range":[28,32,28,33],"value":{"type":"integer","integer":1}}}},{"range":[29,27,30,25],"value":{"field":{"range":[29,27,29,29],"value":"sy"},"expression":{"range":[29,32,29,33],"value":{"type":"integer","integer":1}}}},{"range":[30,27,31,25],"value":{"field":{"range":[30,27,30,28],"value":"o"},"expression":{"range":[30,31,30,32],"value":{"type":"integer","integer":1}}}},{"range":[31,27,72,25],"value":{"field":{"range":[31,27,31,31],"value":"form"},"expression":{"range":[32,29,71,34],"value":{"type":"application","application":[{"range":[32,29,32,37],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"Textured"}}},{"range":[32,38,32,41],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"lut"}}},{"range":[33,33,71,34],"value":{"type":"parenthesized","parenthesized":{"range":[33,34,71,33],"value":{"type":"lambda","lambda":{"patterns":[{"range":[33,35,33,39],"value":{"type":"var","var":{"value":"lut_"}}}],"expression":{"range":[34,37,71,33],"value":{"type":"let","let":{"declarations":[{"range":[35,41,39,41],"value":{"type":"destructuring","destructuring":{"pattern":{"range":[35,41,35,51],"value":{"type":"tuple","tuple":{"value":[{"range":[35,43,35,45],"value":{"type":"var","var":{"value":"w1"}}},{"range":[35,47,35,49],"value":{"type":"var","var":{"value":"h1"}}}]}}},"expression":{"range":[36,45,37,81],"value":{"type":"application","application":[{"range":[36,45,36,63],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["WebGL","Texture"],"name":"size"}}},{"range":[36,64,36,72],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileset_"}}},{"range":[37,49,37,51],"value":{"type":"operator","operator":"|>"}},{"range":[37,52,37,65],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["Tuple"],"name":"mapBoth"}}},{"range":[37,66,37,73],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"toFloat"}}},{"range":[37,74,37,81],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"toFloat"}}}]}}}}},{"range":[39,41,42,37],"value":{"type":"destructuring","destructuring":{"pattern":{"range":[39,41,39,51],"value":{"type":"tuple","tuple":{"value":[{"range":[39,43,39,45],"value":{"type":"var","var":{"value":"w2"}}},{"range":[39,47,39,49],"value":{"type":"var","var":{"value":"h2"}}}]}}},"expression":{"range":[40,45,41,81],"value":{"type":"application","application":[{"range":[40,45,40,63],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["WebGL","Texture"],"name":"size"}}},{"range":[40,64,40,68],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"lut_"}}},{"range":[41,49,41,51],"value":{"type":"operator","operator":"|>"}},{"range":[41,52,41,65],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["Tuple"],"name":"mapBoth"}}},{"range":[41,66,41,73],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"toFloat"}}},{"range":[41,74,41,81],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"toFloat"}}}]}}}}}],"expression":{"range":[43,37,70,42],"value":{"type":"application","application":[{"range":[43,37,43,44],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"Shape2d"}}},{"range":[44,41,70,42],"value":{"type":"record","record":[{"range":[44,43,44,48],"value":{"field":{"range":[44,43,44,44],"value":"x"},"expression":{"range":[44,47,44,48],"value":{"type":"integer","integer":0}}}},{"range":[45,43,46,41],"value":{"field":{"range":[45,43,45,44],"value":"y"},"expression":{"range":[45,47,45,48],"value":{"type":"integer","integer":0}}}},{"range":[46,43,47,41],"value":{"field":{"range":[46,43,46,44],"value":"a"},"expression":{"range":[46,47,46,48],"value":{"type":"integer","integer":0}}}},{"range":[47,43,48,41],"value":{"field":{"range":[47,43,47,45],"value":"sx"},"expression":{"range":[47,48,47,49],"value":{"type":"integer","integer":1}}}},{"range":[48,43,49,41],"value":{"field":{"range":[48,43,48,45],"value":"sy"},"expression":{"range":[48,48,48,49],"value":{"type":"integer","integer":1}}}},{"range":[49,43,50,41],"value":{"field":{"range":[49,43,49,44],"value":"o"},"expression":{"range":[49,47,49,48],"value":{"type":"integer","integer":1}}}},{"range":[50,43,70,41],"value":{"field":{"range":[50,43,50,47],"value":"form"},"expression":{"range":[51,45,69,50],"value":{"type":"application","application":[{"range":[51,45,51,49],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"Form"}}},{"range":[52,49,52,61],"value":{"type":"parenthesized","parenthesized":{"range":[52,50,52,60],"value":{"type":"application","application":[{"range":[52,50,52,52],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"w2"}}},{"range":[52,53,52,54],"value":{"type":"operator","operator":"*"}},{"range":[52,55,52,60],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileW"}}}]}}}},{"range":[53,49,53,61],"value":{"type":"parenthesized","parenthesized":{"range":[53,50,53,60],"value":{"type":"application","application":[{"range":[53,50,53,52],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"h2"}}},{"range":[53,53,53,54],"value":{"type":"operator","operator":"*"}},{"range":[53,55,53,60],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileH"}}}]}}}},{"range":[54,49,69,50],"value":{"type":"parenthesized","parenthesized":{"range":[54,50,69,49],"value":{"type":"lambda","lambda":{"patterns":[{"range":[54,51,54,60],"value":{"type":"var","var":{"value":"translate"}}},{"range":[54,61,54,76],"value":{"type":"var","var":{"value":"scaleRotateSkew"}}},{"range":[54,77,54,84],"value":{"type":"var","var":{"value":"opacity"}}}],"expression":{"range":[55,53,68,58],"value":{"type":"application","application":[{"range":[55,53,55,69],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["WebGL"],"name":"entityWith"}}},{"range":[56,57,56,78],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"defaultEntitySettings"}}},{"range":[57,57,57,73],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["Shader"],"name":"vertImage"}}},{"range":[58,57,58,68],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"fragTilemap"}}},{"range":[59,57,59,68],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":["Shader"],"name":"mesh"}}},{"range":[60,57,68,58],"value":{"type":"record","record":[{"range":[60,59,60,73],"value":{"field":{"range":[60,59,60,61],"value":"uP"},"expression":{"range":[60,64,60,73],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"translate"}}}}},{"range":[61,59,62,57],"value":{"field":{"range":[61,59,61,61],"value":"uT"},"expression":{"range":[61,64,61,79],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"scaleRotateSkew"}}}}},{"range":[62,59,63,57],"value":{"field":{"range":[62,59,62,61],"value":"uA"},"expression":{"range":[62,64,62,71],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"opacity"}}}}},{"range":[63,59,64,57],"value":{"field":{"range":[63,59,63,68],"value":"uTileSize"},"expression":{"range":[63,71,63,87],"value":{"type":"application","application":[{"range":[63,71,63,75],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"vec2"}}},{"range":[63,76,63,81],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileW"}}},{"range":[63,82,63,87],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileH"}}}]}}}},{"range":[64,59,65,57],"value":{"field":{"range":[64,59,64,65],"value":"uAtlas"},"expression":{"range":[64,68,64,76],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"tileset_"}}}}},{"range":[65,59,66,57],"value":{"field":{"range":[65,59,65,69],"value":"uAtlasSize"},"expression":{"range":[65,72,65,82],"value":{"type":"application","application":[{"range":[65,72,65,76],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"vec2"}}},{"range":[65,77,65,79],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"w1"}}},{"range":[65,80,65,82],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"h1"}}}]}}}},{"range":[66,59,67,57],"value":{"field":{"range":[66,59,66,63],"value":"uLut"},"expression":{"range":[66,66,66,70],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"lut_"}}}}},{"range":[67,59,68,57],"value":{"field":{"range":[67,59,67,67],"value":"uLutSize"},"expression":{"range":[67,70,67,80],"value":{"type":"application","application":[{"range":[67,70,67,74],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"vec2"}}},{"range":[67,75,67,77],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"w2"}}},{"range":[67,78,67,80],"value":{"type":"functionOrValue","functionOrValue":{"moduleName":[],"name":"h2"}}}]}}}}]}}]}}}}}}}]}}}}]}}]}}}}}}}}}}]}}}}]}}]}}}}}}}]}}}}]}}]}}}}}}},{"range":[77,1,126,9],"value":{"type":"function","function":{"documentation":null,"signature":null,"declaration":{"range":[77,1,126,9],"value":{"name":{"range":[77,1,77,12],"value":"fragTilemap"},"arguments":[],"expression":{"range":[79,5,126,9],"value":{"type":"glsl","glsl":"\nprecision mediump float;\nvarying vec2 uv;\nuniform sampler2D uAtlas;\nuniform sampler2D uLut;\nuniform vec2 uAtlasSize;\nuniform vec2 uLutSize;\nuniform vec2 uTileSize;\nuniform float uA;\n\nfloat color2float(vec4 color) {\n\n    return\n    color.a * 255.0\n    + color.b * 256.0 * 255.0\n    + color.g * 256.0 * 256.0 * 255.0\n    + color.r * 256.0 * 256.0 * 256.0 * 255.0;\n    }\n\n/**\n * Returns accurate MOD when arguments are approximate integers.\n */\nfloat modI(float a,float b) {\n    float m=a-floor((a+0.5)/b)*b;\n    return floor(m+0.5);\n}\n\nvoid main () {\n   vec2 point = floor(uv * uLutSize);\n   vec2 offset = fract(uv * uLutSize);\n\n   //(2i + 1)/(2N) Pixel center\n   vec2 coordinate = (point + 0.5) / uLutSize;\n   float index = color2float(texture2D(uLut, coordinate));\n   if (index <= 0.0) discard;\n   vec2 grid = uAtlasSize / uTileSize;\n   // tile indexes in uAtlas starts from zero, but in lut zero is used for\n   // \"none\" placeholder\n   vec2 tile = vec2(modI((index - 1.), grid.x), int(index - 1.) / int(grid.x));\n   // inverting reading botom to top\n   tile.y = grid.y - tile.y - 1.;\n   vec2 fragmentOffsetPx = floor(offset * uTileSize);\n   //(2i + 1)/(2N) Pixel center\n   vec2 pixel = (floor(tile * uTileSize + fragmentOffsetPx) + 0.5) / uAtlasSize;\n   gl_FragColor = texture2D(uAtlas, pixel);\n   gl_FragColor.a *= float(index != 0.);\n}\n    "}}}}}}}],"comments":[{"range":[78,5,78,59],"value":"--http://media.tojicode.com/webgl-samples/tilemap.html"}]}